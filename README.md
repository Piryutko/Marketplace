# Marketplace API

## Описание проекта

Marketplace API инфраструктура магазина основанная на работе четырех микросервисах имеющие связь клиент-сервер GRPC, а также с применением шины сообщений Rabbit MQ.

User Registration Service - Сервис регистрации пользователей.
User Storage Service - Хранение пользователей в сервисе.
Item Service - Добавление и хранение данных о товарах.
Shop Service - Создание корзины и покупки товара, получение чека для оплаты.

## Сценарий работы

Покупатель имеет доступ к сервису User Registration Service и Shop Service. При регистрации в User Registration Service
сервис проверит валидность данных через guard библиотеку Ensure.That и в случае невалидности данных, пользователь получит уведомление.
После успешно введеных данных, через шину сообщений Rabbit MQ будет отправлено сообщение в очередь, consumer является User Storage Service,
который проверит данные пользователя на наличие дубликата в базе данных по двум критериям, Nickname и Email.
В случае уже зарегистрированного пользователя с таким же Nickname или Email будет отправлено сообщение по GRPC Server -> Client о недопустимости регистрации, и отображено пользователю в User Registration Service.

После успешной регистрации, пользователь может перейти в ShopService и выбрать подходящие ему товары из ItemService.

ItemService является складом магазина, владелец магазина может добавить свой товар в ItemService указав имя товара, количество, категорию и цену.
При добавлении товара, сервис также проверит валидность введеных данных и сообщит об этом владельцу магазина.

После успешно добавленных товаров в Item Service, в Shop Service будут доступны товары для выбранных категорий пользователя.
Пользователь формирует свою корзину изменяя или удаляя при необходимости позиции в корзине.

По итогам сформированной корзины, создается чек (Order), и происходит взаимодействие трех сервисов
Item Service <- Shop Service -> User Storage Service
При создании чека проверяется наличие товаров из Item Service, а Nickname пользователя сделавшего заказ проверяется в User Storage, все проверки осуществляются через GRPC.
Client -> Server, в данном случае Shop Service является клиентом двух сервисов Item Service и User Storage Service.

Если пользователь не был зарегистрирован в Marketplace, заказ оформить не получится, пользователь получит сообщение о том, что данный никнейм не зарегистрирован в системе.
Если пользователь указал необходимое ему количество товаров, но количество каких либо товаров из корзины отсутствует, будет сформирован чек с товарами доступными к покупке и суммой к оплате, и дополнительно пользователь получит сообщение с позициями товаров которые не были добавлены в чек (Order) из-за отсутствия их на складе.
Если пользователь зарегистрирован в системе, и нужное количество товаров доступно на складе, чек будет сформирован с полной корзиной и сообщением об успешном созданом заказе.

- ## Быстрый старт

Клонировать репозиторий, при работе с локальной версией программы, вам понадобится работающий RabbitMQ поэтому вам необходимо будет скачать Docker, настроить Kubernetes и задеплоить rabbitmq-depl.yaml.

Для работы Marketplace API в пространстве Kubernetes, запустите dockerfile каждого отдельного сервиса, и из папки K8S задеплоить согласно наименованию файлов.

При возникновении ошибок или проблем с работой приложения пишите на почту piryutko@inbox.ru
